{% extends "base.html" %}
{% block title %}Trade Journal - AI Gap Forecaster{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
    <h1 data-testid="page-title">Trade Journal</h1>
    <button class="btn btn-primary" data-testid="trade-new-btn" data-bs-toggle="modal" data-bs-target="#tradeModal"
            onclick="resetTradeForm()">
        + New Trade
    </button>
</div>
<div class="section-divider"></div>

<!-- Filters -->
<div class="row mb-3">
    <div class="col-md-3">
        <select class="form-select" id="statusFilter" data-testid="trades-status-filter">
            <option value="all">All Trades</option>
            <option value="open">Open</option>
            <option value="closed">Closed</option>
            <option value="cancelled">Cancelled</option>
        </select>
    </div>
    <div class="col-md-3">
        <input type="text" class="form-control" id="symbolFilter" placeholder="Filter by symbol..."
               data-testid="trades-symbol-filter">
    </div>
</div>

<!-- Trades table -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover" data-testid="trades-table">
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Direction</th>
                        <th>Gap</th>
                        <th>Entry</th>
                        <th>Exit</th>
                        <th>Qty</th>
                        <th>P&amp;L</th>
                        <th>Status</th>
                        <th>Rating</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tradesBody">
                </tbody>
            </table>
        </div>
        <p id="tradesEmpty" class="text-muted text-center d-none" data-testid="trades-empty">
            No trades yet. Click "+ New Trade" to log your first trade.
        </p>
    </div>
</div>

<!-- Trade Form Modal -->
<div class="modal fade" id="tradeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tradeModalTitle">New Trade</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="tradeForm" data-testid="trade-form">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Symbol</label>
                            <input type="text" class="form-control" id="tradeSymbol" placeholder="AAPL"
                                   data-testid="trade-symbol" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Direction</label>
                            <select class="form-select" id="tradeDirection" data-testid="trade-direction" required>
                                <option value="long">Long</option>
                                <option value="short">Short</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Gap Type</label>
                            <select class="form-select" id="tradeGapType" data-testid="trade-gap-type" required>
                                <option value="gap_up">Gap Up</option>
                                <option value="gap_down">Gap Down</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Entry Price</label>
                            <input type="number" step="0.01" class="form-control" id="tradeEntryPrice"
                                   data-testid="trade-entry-price" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="tradeQuantity"
                                   data-testid="trade-quantity" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Gap %</label>
                            <input type="number" step="0.01" class="form-control" id="tradeGapPercent"
                                   data-testid="trade-gap-percent">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Setup Rating (1-5)</label>
                            <input type="number" min="1" max="5" class="form-control" id="tradeRating"
                                   data-testid="trade-rating">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="tradeNotes" rows="2"
                                      data-testid="trade-notes"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-testid="trade-cancel-btn">Cancel</button>
                <button type="button" class="btn btn-primary" id="tradeSaveBtn" data-testid="trade-save-btn">Save Trade</button>
            </div>
        </div>
    </div>
</div>

<!-- Close Trade Modal -->
<div class="modal fade" id="closeTradeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Close Trade</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Closing trade for <strong id="closeTradeSymbol"></strong></p>
                <input type="hidden" id="closeTradeId">
                <div class="mb-3">
                    <label class="form-label">Exit Price</label>
                    <input type="number" step="0.01" class="form-control" id="closeTradeExitPrice"
                           data-testid="trade-exit-price" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="closeTradeBtn" data-testid="trade-close-confirm">Close Trade</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/journal.js') }}"></script>
{% endblock %}
